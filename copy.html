<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Copying…</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 24px; line-height: 1.5; }
    button { padding: 10px 14px; border: 1px solid #ccc; border-radius: 6px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Copying your comment…</h1>
  <p>If your clipboard doesn’t update automatically, click the button below.</p>
  <p><button id="copyBtn">Copy again</button></p>
  <p>Status: <span id="status">Working…</span></p>

  <script>
    const qp = new URLSearchParams(location.search);
    const b64 = qp.get('t') || '';
    const dest = qp.get('u') || '';
    const delayMs = parseInt(qp.get('d') || '400', 10);

    function b64decodeUnicode(str) {
      try { return decodeURIComponent(escape(atob(str))); }
      catch (e) { return new TextDecoder().decode(Uint8Array.from(atob(str), c => c.charCodeAt(0))); }
    }

    const text = b64 ? b64decodeUnicode(b64) : '';

    async function doCopy() {
      const status = document.getElementById('status');
      try {
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(text);
        } else {
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.style.position = 'fixed'; ta.style.left = '-9999px';
          document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
        }
        status.textContent = 'Copied. Redirecting…';
        if (dest) setTimeout(() => { location.href = dest; }, delayMs);
      } catch (e) {
        status.textContent = 'Could not copy automatically. Use the button.';
      }
    }

    document.getElementById('copyBtn').addEventListener('click', doCopy);
    doCopy(); // try on load
  </script>
</body>
</html>
